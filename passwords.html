<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurePass</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
            transition: background-color 0.3s, color 0.3s;
        }

        .password-card {
            border-radius: 12px;
            padding: 15px;
            background: #ffffff;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
            transition: background 0.3s;
        }

        .btn-primary {
            background-color: #e67e22;
            border: none;
        }

        .footer {
            background-color: #f4e1c6;
            text-align: center;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        .modal-content {
            background-color: #ffffff;
        }

        .modal-Text {
            color: rgb(0, 0, 0);
        }

        .close {
            color: rgb(0, 0, 0);
        }

        .dark-mode {
            background-color: #121212;
            color: #ffffff;
        }

        .dark-mode .password-card {
            background: #1e1e1e;
            color: white;
        }

        .dark-mode .footer {
            background-color: #333;
        }

        .dark-mode .modal-content {
            background-color: #1e1e1e;
        }

        .dark-mode .modal-Text {
            color: rgb(255, 255, 255);
        }

        .dark-mode .close {
            color: rgb(255, 255, 255);
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-light bg-light p-3">
        <a class="navbar-brand font-weight-bold" href="dashboard.html">ðŸ”’ SecurePass</a>
        <input type="text" id="searchInput" class="form-control w-25" placeholder="Search passwords..."
            onkeyup="searchPasswords()">
        <button id="darkModeToggle" class="toggle-btn">
            <i class="fas fa-moon"></i>
        </button>
    </nav>

    <div class="container mt-4">
        <button class="btn btn-primary mb-3" data-toggle="modal" data-target="#addPasswordModal">Add New
            Password</button>

        <!-- Filter Button -->
        <div class="mb-3">
            <select id="filterGroup" class="form-control w-25 d-inline-block">
                <!-- Groups -->
                <option value="all">All Groups</option>
            </select>
            <button class="btn btn-primary" onclick="filterPasswords()">Filter</button>
        </div>

        <div class="passwords" id="passwords">
            <!-- Password Cards -->
        </div>

    </div>

    <div class="footer">SecurePass Â© 2025</div>

    <!-- Show passwords modal -->
    <div class="modal fade" id="passwordModal" tabindex="-1" role="dialog" aria-labelledby="passwordModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>

                    <div class="viewAccountPassword" id="viewAccountPassword">

                        <h5 class="text-center"> View Password </h5>

                        <div id="editAccountPasswordInfoMessage" class="alert alert-dismissible fade show"
                            style="display: none;"> </div>
                        <div id="deleteAccountPasswordInfoMessage" class="alert alert-dismissible fade show"
                            style="display: none;"> </div>

                        <div class="form-group">
                            <label for="viewAccountPasswordGroup">Group</label>
                            <input type="text" class="form-control" id="viewAccountPasswordGroupValue" disabled>
                        </div>
                        <div class="form-group">
                            <label for="viewAccountPasswordAccountName"> Account Name </label>
                            <input type="text" class="form-control" id="viewAccountPasswordAccountName" disabled>
                        </div>
                        <div class="form-group">
                            <label for="viewAccountPasswordUsername">Username</label>
                            <input type="text" class="form-control" id="viewAccountPasswordUsername" disabled>
                        </div>
                        <input type="hidden" id="viewAccountPasswordId" name="viewAccountPasswordId">
                        <div class="form-group">
                            <label for="viewAccountPasswordPassword">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="viewAccountPasswordPassword" disabled>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                        id="togglePasswordForView"><i class="fas fa-eye"></i></button>
                                </div>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="copyPassword"><i
                                            class="far fa-clone"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="viewAccountPasswordUrl">URL</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="viewAccountPasswordUrl" disabled>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="launchUrl"><i
                                            class="fas fa-share	"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="viewAccountPasswordNotes">Notes</label>
                            <textarea class="form-control" id="viewAccountPasswordNotes" disabled></textarea>
                        </div>
                    </div>

                    <div class="editAccountPassword" id="editAccountPassword" style="display:none;">

                        <h5 class="text-center"> Edit Password </h5>

                        <div class="form-group">
                            <label for="group">Group</label>
                            <select id="group" class="form-control">
                                <!-- Groups -->
                                <option value="new">Add New Group</option>
                            </select>
                            <input type="text" class="form-control mt-2 d-none" id="newGroup"
                                placeholder="Enter new group name">
                        </div>
                        <div class="form-group">
                            <label for="editAccountPasswordAccountName"> Account Name </label>
                            <input type="text" class="form-control" id="editAccountPasswordAccountName">
                        </div>
                        <div class="form-group">
                            <label for="editAccountPasswordUsername">Username</label>
                            <input type="text" class="form-control" id="editAccountPasswordUsername">
                        </div>
                        <input type="hidden" id="editAccountPasswordId" name="editAccountPasswordId">
                        <div class="form-group">
                            <label for="editAccountPasswordPassword">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="editAccountPasswordPassword">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                        id="togglePasswordForEdit"><i class="fas fa-eye"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editAccountPasswordUrl">URL</label>
                            <input type="text" class="form-control" id="editAccountPasswordUrl">
                        </div>
                        <div class="form-group">
                            <label for="editAccountPasswordNotes">Notes</label>
                            <textarea class="form-control" id="editAccountPasswordNotes"></textarea>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="editAccountPasswordBtn">Edit</button>
                    <button class="btn btn-success" id="saveAccountPasswordBtn" style="display:none;">Save</button>
                    <button class="btn btn-danger" id="deleteAccountPasswordBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Add Password Modal -->
    <div class="modal fade" id="addPasswordModal" tabindex="-1" role="dialog" aria-labelledby="addPasswordModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>

                    <div class="addNewAccountPassword" id="addNewAccountPassword">

                        <h5 class="text-center"> Add New Password </h5>

                        <div id="addNewAccountPasswordInfoMessage" class="alert alert-dismissible fade show"> </div>

                        <div class="form-group">
                            <label for="addNewGroup">Group</label>
                            <select id="addNewGroup" class="form-control">
                                <!-- Groups -->
                                <option value="new">Add New Group</option>
                            </select>
                            <input type="text" class="form-control mt-2 d-none" id="addNewGroupCreate"
                                placeholder="Enter new group name">
                        </div>
                        <div class="form-group">
                            <label for="addNewAccountName"> Account Name </label>
                            <input type="text" class="form-control" id="addNewAccountName" required>
                        </div>
                        <div class="form-group">
                            <label for="addNewUsername">Username</label>
                            <input type="text" class="form-control" id="addNewUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="addNewPassword">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="addNewPassword" required>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                        id="togglePasswordForAddNewPassword"><i class="fas fa-eye"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="addNewPasswordUrl">URL</label>
                            <input type="text" class="form-control" id="addNewPasswordUrl" placeholder="Enter URL">
                        </div>
                        <div class="form-group">
                            <label for="addNewPasswordNotes">Notes</label>
                            <textarea class="form-control" id="addNewPasswordNotes"
                                placeholder="Enter notes"></textarea>
                        </div>
                    </div>
                    <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button id="addNewPasswordBtn" class="btn btn-primary">Add Password</button>
                </div>
            </div>
        </div>
    </div>

    <script src="darkmode.js"></script>
    <script>

        var passwordData = { data: [] }; // Global object to store password data

        // send request to check sessions
        $(document).ready(function () {
            $.ajax({
                url: "API/check_and_maintain_session_and_cookies.php",
                method: "POST",
                dataType: "json",
                success: function (response) {
                    if (response.message === "not_logged_in") {
                        window.location.href = "login.html";
                    }
                    else {
                        fetch('API/fetch_password.php')
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    passwordData.data = data.data;
                                    console.log("Data received:", passwordData.data);
                                    let myPasswordsDiv = document.getElementById("passwords");
                                    let selectGroupElement = document.getElementById("filterGroup");
                                    let addPasswordGroupElement = document.getElementById("group");
                                    let addNewAccountGroupElement = document.getElementById("addNewGroup");

                                    let uniqueGroups = [...new Set(passwordData.data.map(row => row.GroupName))];

                                    uniqueGroups.forEach(GroupName => {
                                        let selectHTML = `
                                                        <option value="${GroupName}">${GroupName}</option>
                                                    `;

                                        // Append card to the div
                                        selectGroupElement.innerHTML += selectHTML;

                                        let selectGroupHTML = `
                                                        <option value="${GroupName}">${GroupName}</option>
                                                    `;

                                        // Append card to the div
                                        addPasswordGroupElement.innerHTML += selectGroupHTML;

                                        let selectGroupForAddNewAccountHTML = `
                                                        <option value="${GroupName}">${GroupName}</option>
                                                    `;

                                        // Append card to the div
                                        addNewAccountGroupElement.innerHTML += selectGroupForAddNewAccountHTML;
                                    });

                                    data.data.forEach(row => {

                                        if (row.IsAccountShared == 1) {
                                            var ShareIcon = '<span class="d-inline-block" tabindex="0" data-toggle="SharePopover" data-placement="top"  data-content="You are sharing this account with others.">&nbsp&nbsp<i class="fa-solid fa-users"></i></span>';
                                        }
                                        else {
                                            var ShareIcon = '';
                                        }
                                        let cardHTML = `
                                                        <div class="password-card p-3 mb-3" 
                                                            data-uuid="${row.ID}"
                                                            data-group="${row.GroupName}" 
                                                            data-website="${row.AppName}" 
                                                            data-username="${row.UserName}" 
                                                            data-password="${row.Password}" 
                                                            data-websiteurl="${row.WebsiteUrl}" 
                                                            data-notes="${row.Notes}">
                                                            
                                                            <h5 class="password-Appname-title"><b>${row.AppName}</b>
                                                                ${ShareIcon}
                                                            </h5>
                                                            <p class="text-muted password-account-username">User Name: ${row.UserName}</p>
                                                        </div>
                                                    `;

                                        // Append card to the div
                                        myPasswordsDiv.innerHTML += cardHTML;

                                        // Show data if password card is clicked
                                        $(document).ready(function () {
                                            $('.password-card').click(function () {
                                                // Get data from the clicked card
                                                var ID = $(this).data('uuid');
                                                var group = $(this).data('group');
                                                var website = $(this).data('website');
                                                var username = $(this).data('username');
                                                var password = $(this).data('password');
                                                var websiteurl = $(this).data('websiteurl');
                                                var notes = $(this).data('notes');

                                                // Set data inside modal
                                                $('#viewAccountPasswordId').val(ID);
                                                $('#viewAccountPasswordGroupValue').val(group);
                                                $('#viewAccountPasswordAccountName').val(website);
                                                $('#viewAccountPasswordUsername').val(username);
                                                $('#viewAccountPasswordPassword').val(password);
                                                $('#viewAccountPasswordUrl').val(websiteurl);
                                                $('#viewAccountPasswordNotes').val(notes);

                                                // Show the modal
                                                $('#passwordModal').modal('show');
                                            });
                                        });

                                    });
                                } else {
                                    console.error("Error:", data.message);
                                }
                            })
                            .catch(error => console.error('Fetch Error:', error));
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                }
            });
        });


        var editAccountPassword = document.getElementById("editAccountPassword");
        var viewAccountPassword = document.getElementById("viewAccountPassword");
        var editAccountPasswordBtn = document.getElementById("editAccountPasswordBtn");
        var saveAccountPasswordBtn = document.getElementById("saveAccountPasswordBtn");

        $('#editAccountPasswordBtn').click(function () {
            $('#editAccountPassword').show();
            $('#viewAccountPassword').hide();
            $('#editAccountPasswordBtn').hide();
            $('#saveAccountPasswordBtn').show();

            $('#editAccountPasswordId').val($('#viewAccountPasswordId').val());
            $('#group').val($('#viewAccountPasswordGroupValue').val()).trigger('change');
            $('#editAccountPasswordAccountName').val($('#viewAccountPasswordAccountName').val());
            $('#editAccountPasswordUsername').val($('#viewAccountPasswordUsername').val());
            $('#editAccountPasswordPassword').val($('#viewAccountPasswordPassword').val());
            $('#editAccountPasswordUrl').val($('#viewAccountPasswordUrl').val());
            $('#editAccountPasswordNotes').val($('#viewAccountPasswordNotes').val());

        });

        // Save edited account password details
        $('#saveAccountPasswordBtn').click(function () {

            // Get form data
            var formData = {
                group: $('#group').val(),
                newGroup: $('#newGroup').val(),
                AccountName: $('#editAccountPasswordAccountName').val(),
                Username: $('#editAccountPasswordUsername').val(),
                Password: $('#editAccountPasswordPassword').val(),
                Url: $('#editAccountPasswordUrl').val(),
                Notes: $('#editAccountPasswordNotes').val(),
                ID: $('#editAccountPasswordId').val(),
                saveEditedAccount: true,
            };
            console.log(formData);
            $.ajax({
                type: 'POST',
                url: 'API/save_account_password.php',
                data: formData,
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        if (response.message == 'saveEditAccount=true') {
                            // Show success message in the modal
                            $('#editAccountPasswordInfoMessage').removeClass('alert-danger').addClass('alert-success').html('Account details saved successfully.').show();

                            $('#editAccountPassword').hide();
                            $('#viewAccountPassword').show();
                            $('#editAccountPasswordBtn').show();
                            $('#saveAccountPasswordBtn').hide();

                            setTimeout(function () {
                                $('#editAccountPasswordInfoMessage').hide();

                                $('#viewAccountPasswordGroupValue').val(formData.group).trigger('change');
                                $('#viewAccountPasswordAccountName').val(formData.AccountName);
                                $('#viewAccountPasswordUsername').val(formData.Username);
                                $('#viewAccountPasswordPassword').val(formData.Password);
                                $('#viewAccountPasswordUrl').val(formData.Url);
                                $('#viewAccountPasswordNotes').val(formData.Notes);

                                let card = $(`.password-card[data-uuid="${formData.ID}"]`);
                                let selectedFilterGroup = $('#filterGroup').val();
                                let newGroupName = formData.newGroup.trim();

                                // Update card attributes
                                card.attr('data-uuid', formData.ID);
                                if (newGroupName !== "") {
                                    card.attr('data-group', formData.newGroup);
                                } else {
                                    card.attr('data-group', formData.group);
                                }
                                card.attr('data-website', formData.AccountName);
                                card.attr('data-username', formData.Username);
                                card.attr('data-password', formData.Password);
                                card.attr('data-websiteurl', formData.Url);
                                card.attr('data-notes', formData.Notes);

                                // Also update jQuery's cached data properties
                                card.data('ID', formData.ID);
                                if (newGroupName !== "") {
                                    card.data('group', formData.newGroup);
                                } else {
                                    card.data('group', formData.group);
                                }
                                card.data('website', formData.AccountName);
                                card.data('username', formData.Username);
                                card.data('password', formData.Password);
                                card.data('websiteurl', formData.Url);
                                card.data('notes', formData.Notes);


                                // Update card content
                                card.find('.password-Appname-title').html(`<b>${formData.AccountName}</b>`);
                                card.find('.password-account-username').text(`User Name: ${formData.Username}`);

                                // **Update passwordData.data[]**
                                let itemIndex = passwordData.data.findIndex(item => item.ID == formData.ID);
                                if (itemIndex !== -1) {
                                    passwordData.data[itemIndex].ID = formData.ID;
                                    passwordData.data[itemIndex].GroupName = formData.group;
                                    passwordData.data[itemIndex].AppName = formData.AccountName;
                                    passwordData.data[itemIndex].UserName = formData.Username;
                                    passwordData.data[itemIndex].Password = formData.Password;
                                    passwordData.data[itemIndex].WebsiteUrl = formData.Url;
                                    passwordData.data[itemIndex].Notes = formData.Notes;
                                }

                                // **Update the dropdowns with new group if applicable**
                                if (newGroupName !== "") {
                                    let groupDropdown = $('#filterGroup');
                                    let editGroupDropdown = $('#group');

                                    // Check if the new group already exists
                                    if (groupDropdown.find(`option[value="${newGroupName}"]`).length === 0) {
                                        let newOption = `<option value="${newGroupName}">${newGroupName}</option>`;

                                        // Add to filter dropdown
                                        groupDropdown.append(newOption);

                                        // Add to edit modal group dropdown
                                        editGroupDropdown.append(newOption);
                                    }
                                }

                                // Apply filter again to hide/show the updated card
                                filterPasswords();

                                console.log("Account details saved successfully.");

                            }, 2000);
                        }
                    } else {
                        // Show error message in the modal
                        $('#editAccountPasswordInfoMessage').removeClass('alert-success').addClass('alert-danger').html('Error saving account details.').show();
                        console.log(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                }
            });
        });

        // Add New Account Password
        $('#addNewPasswordBtn').click(function () {
            // Get form data
            var formData = {
                group: $('#addNewGroup').val(),
                newGroup: $('#addNewGroupCreate').val(),
                AccountName: $('#addNewAccountName').val(),
                Username: $('#addNewUsername').val(),
                Password: $('#addNewPassword').val(),
                Url: $('#addNewPasswordUrl').val(),
                Notes: $('#addNewPasswordNotes').val(),
                saveNewAccount: true,
            };
            console.log("New Account's Details to save:");
            console.log(formData);
            $.ajax({
                type: 'POST',
                url: 'API/save_account_password.php',
                data: formData,
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        if (response.message == 'addNewAccount=true') {
                            // Create the new password object
                            let newPassword = {
                                ID: response.id,  // Assuming the API returns the new ID
                                group: formData.newGroup ? formData.newGroup : formData.group,
                                AccountName: formData.AccountName,
                                Username: formData.Username,
                                Password: formData.Password,
                                Url: formData.Url,
                                Notes: formData.Notes
                            };

                            // Add to passwordData.data
                            passwordData.data.push(newPassword);

                            // Create a new password card
                            let newCard = `
                                            <div class="password-card p-3 mb-3" 
                                                data-uuid="${newPassword.ID}"
                                                data-group="${newPassword.group}" 
                                                data-website="${newPassword.AccountName}" 
                                                data-username="${newPassword.Username}" 
                                                data-password="${newPassword.Password}" 
                                                data-websiteurl="${newPassword.Url}" 
                                                data-notes="${newPassword.Notes}">
                                                            
                                                <h5 class="password-Appname-title"><b>${newPassword.AccountName}</b></h5>
                                                <p class="text-muted password-account-username">User Name: ${newPassword.Username}</p>
                                            </div>
                                        `;

                            // Append the new card only if it's in the current filter group
                            if ($("#filterGroup").val() === "all" || $("#filterGroup").val() === newPassword.group) {
                                $("#passwords").append(newCard);
                            }

                            // Add new group to filter dropdown and edit modal select if needed
                            let groupToAdd = newPassword.group;
                            if ($(`#filterGroup option[value="${groupToAdd}"]`).length === 0) {
                                $("#filterGroup, #editAccountPasswordGroup").append(
                                    `<option value="${groupToAdd}">${groupToAdd}</option>`
                                );
                            }

                            $(document).on("click", ".password-card", function () {
                                let card = $(this);

                                var ID = $(this).data('uuid');
                                var group = $(this).data('group');
                                var website = $(this).data('website');
                                var username = $(this).data('username');
                                var password = $(this).data('password');
                                var websiteurl = $(this).data('websiteurl');
                                var notes = $(this).data('notes');

                                // Set data inside modal
                                $('#viewAccountPasswordId').val(ID);
                                $('#viewAccountPasswordGroupValue').val(group);
                                $('#viewAccountPasswordAccountName').val(website);
                                $('#viewAccountPasswordUsername').val(username);
                                $('#viewAccountPasswordPassword').val(password);
                                $('#viewAccountPasswordUrl').val(websiteurl);
                                $('#viewAccountPasswordNotes').val(notes);


                                $("#passwordModal").modal("show");
                            });

                            // Show success message
                            $('#addNewAccountPasswordInfoMessage').removeClass('alert-danger').addClass('alert-success').html('New Account added successfully.').show();

                            setTimeout(function () {
                                $('#addNewAccountPasswordInfoMessage').hide();

                                $('#addNewGroup').val("");
                                $('#addNewGroupCreate').val("");
                                $('#addNewAccountName').val("");
                                $('#addNewUsername').val("");
                                $('#addNewPassword').val("");
                                $('#addNewPasswordUrl').val("");
                                $('#addNewPasswordNotes').val("");

                            }, 2000);
                            console.log("New Account added successfully.");
                        }
                    } else {
                        // Show error message in the modal
                        $('#addNewAccountPasswordInfoMessage').removeClass('alert-success').addClass('alert-danger').html('Error adding new account.').show();
                        console.log(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                }
            });
        });

        // Delete Account/Password
        $('#deleteAccountPasswordBtn').click(function () {
            // Get form data
            var formDeleteData = {
                ID: $('#viewAccountPasswordId').val(),
                deleteAccountPassword: true,
            };
            console.log("Account/Password to be deleted with ID:");
            console.log(formDeleteData);
            $.ajax({
                type: 'POST',
                url: 'API/delete_account_password.php',
                data: formDeleteData,
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        if (response.message == 'deleteAccountPassword=success') {

                            // Remove the password card from the DOM
                            $(`.password-card[data-uuid="${formDeleteData.ID}"]`).remove();

                            // Remove from passwordData.data
                            passwordData.data = passwordData.data.filter(item => item.ID !== formDeleteData.ID);

                            $('#editAccountPassword').hide();
                            $('#viewAccountPassword').show();
                            $('#editAccountPasswordBtn').show();
                            $('#saveAccountPasswordBtn').hide();

                            // Show success message in the modal
                            $('#deleteAccountPasswordInfoMessage').removeClass('alert-danger').addClass('alert-success').html('Deleted Account/Password successfully.').show();

                            setTimeout(function () {
                                $('#deleteAccountPasswordInfoMessage').hide();
                                // Close the modal
                                $('#passwordModal').modal('hide');
                            }, 2000);
                            console.log("Deleted Account/Password successfully.");
                        }
                    } else {
                        // Show error message in the modal
                        $('#deleteAccountPasswordInfoMessage').removeClass('alert-success').addClass('alert-danger').html('Error deleting account/password.').show();
                        console.log(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                }
            });
        });

        // Filter passwords by group
        function filterPasswords() {
            const selectedGroup = document.getElementById("filterGroup").value;
            const cards = document.querySelectorAll(".password-card");

            cards.forEach(card => {
                if (selectedGroup === "all" || card.dataset.group === selectedGroup) {
                    card.style.display = "block";
                } else {
                    card.style.display = "none";
                }
            });
        }

        // Show/Hide new group input for edit password modal
        $('#group').change(function () {
            if ($(this).val() === 'new') {
                $('#newGroup').removeClass('d-none');
            } else {
                $('#newGroup').addClass('d-none');
            }
        });

        // Show/Hide new group input for add password modal
        $('#addNewGroup').change(function () {
            if ($(this).val() === 'new') {
                $('#addNewGroupCreate').removeClass('d-none');
            } else {
                $('#addNewGroupCreate').addClass('d-none');
            }
        });

        // Toggle password visibility for add new password
        $('#togglePasswordForAddNewPassword').click(function () {
            const passwordField = $('#addNewPassword');
            const type = passwordField.attr('type') === 'password' ? 'text' : 'password';
            passwordField.attr('type', type);
            $(this).find('i').toggleClass('fa-eye fa-eye-slash');
        });

        // Toggle password visibility for view password
        $("#togglePasswordForView").click(function () {
            let passwordField = $("#viewAccountPasswordPassword");
            let type = passwordField.attr("type") === "password" ? "text" : "password";
            passwordField.attr("type", type);
            $(this).find("i").toggleClass("fa-eye fa-eye-slash");
        });

        // Toggle password visibility for Edit password
        $("#togglePasswordForEdit").click(function () {
            let passwordField = $("#editAccountPasswordPassword");
            let type = passwordField.attr("type") === "password" ? "text" : "password";
            passwordField.attr("type", type);
            $(this).find("i").toggleClass("fa-eye fa-eye-slash");
        });

        // Copy password to clipboard
        $("#copyPassword").click(function () {
            let passwordField = $("#viewAccountPasswordPassword");
            let password = passwordField.val();
            var button = document.getElementById('copyPassword');

            if (password) {
                navigator.clipboard.writeText(password).then(() => {
                    // Initialize the popover
                    var popover = new bootstrap.Popover(button, {
                        trigger: 'manual',
                        placement: 'bottom',
                        content: 'Password copied to clipboard!',
                    });

                    popover.show();

                    setTimeout(function () {
                        popover.hide();
                        popover.dispose();
                    }, 2000);

                    console.log("Password copied to clipboard!");
                }).catch(err => {
                    console.error("Error copying text: ", err);
                });
            }
        });

        // clear fields in edit accounts password modal before closing
        $('#passwordModal').on('hidden.bs.modal', function () {
            $(this).find('#editAccountPassword').find('input, textarea, select').val('');
            // Hide Edit section and only show view section
            $('#editAccountPassword').hide();
            $('#viewAccountPassword').show();
            $('#editAccountPasswordBtn').show();
            $('#saveAccountPasswordBtn').hide();
        });

        // clear fields in Add new account password modal before closing
        $('#addPasswordModal').on('hidden.bs.modal', function () {
            $(this).find('#addNewAccountPassword').find('input, textarea, select').val('');
        });

        // Open URL in a new tab
        $("#launchUrl").click(function () {
            let url = $("#viewAccountPasswordUrl").val().trim();

            if (url) {
                // Ensure the URL has a proper scheme (http or https)
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url; // Default to HTTPS
                }

                window.open(url, "_blank");
            }
        });

        $(document).ready(function () {
            $('[data-toggle="SharePopover"]').popover({
                trigger: 'hover'
            });
        });

        // Search passwords
        function searchPasswords() {
            const searchValue = document.getElementById("searchInput").value.toLowerCase();
            const cards = document.querySelectorAll(".password-card");

            cards.forEach(card => {
                const searchAppname = card.querySelector(".password-Appname-title").textContent.toLowerCase();
                const searchUsername = card.querySelector(".password-account-username").textContent.toLowerCase();

                if (searchAppname.includes(searchValue)) {
                    card.style.display = "block";
                } else if (searchUsername.includes(searchValue)) {
                    card.style.display = "block";
                } else {
                    card.style.display = "none";
                }
            });
        }
    </script>
</body>

</html>